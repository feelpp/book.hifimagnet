[[post_manual]]
= {hifimagnet} PostProcessing documentation
:toc: macro
include::{partialsdir}/header-macros.adoc[]
include::{partialsdir}/header-uri.adoc[]
include::{partialsdir}/mso4sc-uri.adoc[]

Welcome to {hifimagnet} processing documentation!

== Directory structure

The simulations results are stored in the directory defined by
the `directory` key in the cfg file. This path is relative to
the directory `feel` defined in your environment or by default.


[NOTE]
====
The `FEELPP_REPOSITORY` environment variable define
the default value for `feel` directory.

When running {hifimagnet} or {feelpp} apps on premise,
 `FEELPP_REPOSITORY` points to `$HOME/feel` if not explicitly specified.

When using container, `FEELPP_REPOSITORY` is set to `/feel` in
the container. When running the container, you actually mount
a user defined directory as the `/feel` directory in the container
using for instance `-B $PWD:/feel` in {singularity}.
====

.Structure of `feel` directory
[source,sh]
----
include::{examplesdir}/feel-dir-struc.txt[]
----

The results, per se, are stored in the `np_32` directory.
The name changes according to the number of cores you have used for running your simulations.
The content of this directory depends on the xref:user:index.adoc#PostProcessJson[`PostProcess` section] in the json model file.
Generally this directory will hold:

* some `csv` files,
* some `physic.save` directories that contain solution for `physic` in hdf5 format,
* some `physic.exports` directories that contain files for visualization for each `physic`

In addition you can find files for logging what has been done during the simulation
and some journal files to access some statistics about your simulation.


[[csv]]
== Viewing `csv` files

`csv` files contains the data corresponding to `Measures` data.
These files may be read using any csv apps.

[NOTE]
====
using matplotlib and pandas
====

[[ensight]]
== Using {ensight}

`physic.export` directory contain files for visualization. The native format for this file is `Ensight  Gold`.


[[ensight_on_premise]]
=== On Premise

* type `ensight202`

[[ensight_remote]]
=== Remote rendering

For large simulation, we advise you to use ensight remote rendering mode,
even if you can connect via `ssh -Y` to the server where the results are stored.
Of course, this requires that {ensight} is installed on you machine and on the server.

[NOTE]
====
{ensight} is not installed on Gricad machine. You need to download your results data
for visualization.
====

To start remote rendering, on Linux just type:

[source,sh]
----
[~trophime/Ansys_exec/ansys_inc/v202/CEI/bin/]ceistart202
----

on windows:

[source,bat]
----
["C:\Program Files\Ansys Inc\v202\CEI\bin"\]ceistart202
----

* Check the `Remote Server` menu,
* Enter the name of `Remote computer` to be used
* Uncheck the `ssh Tunnel` options
* Click on `Launch`

After some seconds (or minutes) depending on your connection, you will get the main {ensight} window.

image:Ensight-main.png[Ensight main window]

Finaly, click on `Cancel` and proceed to load your data.
From the top menu `File`:

* click on `Open`
* navigate to your data `Export` directory
* Select the `case` file

In the left part of {ensight} windows, you shall see the details of the loaded parts for your `case`

image:Ensight-loaddata.png[Loading a thermoelectric simulation]

Now you can select your `case` in the part view and move you data in the main visualization frame with mouse buttons.

image:Ensight-loaddata1.png[Loading a thermoelectric simulation]

[NOTE]
====
By default, the geometry will be displayed as wireframes.
To change this default, once you have slected your parts you have to switch to `3D full model`.
This may be done by clicking on the "cube" icon.
====

To view the temperature field in the magnet:

* right click on the selected part
* 

image:Ensight-displaydata.png[Display temperature field]


Now we will remove 1/4th of the insert to have a better view of the temperature distribution.
To do so:

* select all the parts,
* click on the cissors icon

This will bring up a new window:

image:Ensight-removebox.png[Remove part of the insert]

* check box and outside from the slidding menus
* check `advanced`
* define the geometry of the box
* finaly click on `create with selected part` at the button of newly create windows

image:Ensight-displaydata-detail.png[Define box geometry]

You shall see something like that:

image:Ensight-displaydata-detailres.png[Display detailed temperature distribution]


TODO

* plot on line
* save image
* notes on {hifimagnet} toolbox
* notes on python interface

[[ensight_on_remotedesktop]]
=== On Remote desktop


[[paraview]]
== Using {paraview}

[[paraview_on_premise]]
=== On Premise

* type `paraview`

[[paraview_on_remotedesktop]]
=== On Remote desktop


